<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>澳门六合彩开奖记录</title>  
    <script src="https://cdn.tailwindcss.com"></script>  
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>  
    <style>  
        [x-cloak] { display: none !important; }  
        .ball {  
            width: 38px; height: 38px;  
            display: flex; align-items: center; justify-content: center;  
            border-radius: 50%; color: white; font-weight: bold; font-size: 1rem;  
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);  
        }  
        .bg-red { background: linear-gradient(180deg, #ff5f6d, #ff3131); }  
        .bg-blue { background: linear-gradient(180deg, #2193b0, #6dd5ed); }  
        .bg-green { background: linear-gradient(180deg, #11998e, #38ef7d); }  
        .zodiac { font-size: 0.7rem; color: #666; margin-top: 2px; font-weight: bold; }  
    </style>  
</head>  
<body class="bg-gray-100 min-h-screen">  
  
<div x-data="lotteryApp()" x-init="init()" class="max-w-md mx-auto shadow-xl min-h-screen bg-gray-50 flex flex-col">  
      
    <!-- 顶部导航 -->  
    <header class="bg-indigo-700 text-white px-4 py-3 sticky top-0 z-50 shadow-md flex justify-between items-center">  
        <div>  
            <h1 class="text-lg font-black tracking-tighter">MACAU JC</h1>  
        </div>  
        <!-- 年份选择 -->  
        <div class="flex items-center bg-indigo-800 rounded-lg px-2">  
            <select x-model="selectedYear" @change="resetPagination()" class="bg-transparent text-sm py-1 outline-none border-none">  
                <template x-for="y in years" :key="y">  
                    <option :value="y" x-text="y + '年'" class="text-black"></option>  
                </template>  
            </select>  
        </div>  
    </header>  
  
    <div x-show="loading" class="text-center py-20 text-gray-500">  
        <div class="animate-spin inline-block w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full mb-2"></div>  
        <p>数据加载中...</p>  
    </div>  
  
    <!-- 主体内容 -->  
    <div x-show="!loading" x-cloak class="p-3 flex-1">  
          
        <!-- 最新一期卡片 (仅在第一页且未筛选年份或筛选今年时显示) -->  
        <template x-if="page === 1 && allRecords.length > 0">  
            <div class="bg-white rounded-2xl shadow-sm overflow-hidden mb-5 border border-indigo-100">  
                <div class="bg-indigo-50 px-4 py-2 flex justify-between items-center">  
                    <span class="text-indigo-800 font-bold text-sm">最新第 <span x-text="allRecords[0].expect"></span> 期</span>  
                    <span class="text-[10px] text-gray-400" x-text="allRecords[0].openTime"></span>  
                </div>  
                <div class="p-4 flex justify-between items-center">  
                    <template x-for="ball in formatBalls(allRecords[0])">  
                        <div class="flex flex-col items-center">  
                            <div :class="'ball bg-' + ball.color" x-text="ball.num"></div>  
                            <span class="zodiac" x-text="ball.zodiac"></span>  
                        </div>  
                    </template>  
                </div>  
            </div>  
        </template>  
  
        <!-- 历史列表 -->  
        <div class="space-y-3">  
            <template x-for="(item, index) in displayedRecords" :key="item.expect">  
                <!-- 过滤掉最新一期防止重复 -->  
                <div x-show="item.expect !== allRecords[0].expect" class="bg-white p-3 rounded-xl shadow-sm border border-gray-100">  
                    <div class="flex justify-between items-center mb-2">  
                        <span class="text-xs font-bold text-gray-500">第 <span x-text="item.expect"></span> 期</span>  
                        <span class="text-[10px] text-gray-300" x-text="item.openTime.split(' ')[0]"></span>  
                    </div>  
                    <div class="flex items-center space-x-2">  
                        <template x-for="ball in formatBalls(item)">  
                            <div class="flex flex-col items-center scale-90">  
                                <div :class="'w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold bg-' + ball.color" x-text="ball.num"></div>  
                                <span class="text-[10px] text-gray-400 mt-0.5" x-text="ball.zodiac"></span>  
                            </div>  
                        </template>  
                    </div>  
                </div>  
            </template>  
        </div>  
  
        <!-- 滚动监听锚点 -->  
        <div id="infinite-sentinel" class="h-10 flex items-center justify-center text-gray-400 text-xs mt-4">  
            <span x-show="hasMore">正在加载更多...</span>  
            <span x-show="!hasMore && displayedRecords.length > 0">已加载全部记录</span>  
        </div>  
    </div>  
</div>  
  
<script>  
function lotteryApp() {  
    return {  
        loading: true,  
        allRecords: [],        // 全量 JSON 数据  
        filteredRecords: [],   // 经过年份筛选的数据  
        displayedRecords: [],  // 当前页面展示的数据  
        selectedYear: new Date().getFullYear().toString(),  
        years: ['2025', '2024', '2023', '2022', '2021', '2020'],  
        page: 1,  
        pageSize: 15,  
        hasMore: true,  
  
        async init() {  
            try {  
                const res = await fetch('data.json?t=' + Date.now());  
                this.allRecords = await res.json();  
                this.resetPagination();  
                  
                // 初始化滚动监听 (Intersection Observer)  
                const observer = new IntersectionObserver((entries) => {  
                    if (entries[0].isIntersecting && !this.loading && this.hasMore) {  
                        this.loadMore();  
                    }  
                }, { threshold: 0.1 });  
                  
                observer.observe(document.getElementById('infinite-sentinel'));  
            } catch (e) {  
                console.error("加载失败");  
            }  
            this.loading = false;  
        },  
  
        // 当切换年份时重置  
        resetPagination() {  
            this.page = 1;  
            // 根据年份过滤  
            this.filteredRecords = this.allRecords.filter(item =>   
                item.openTime.startsWith(this.selectedYear)  
            );  
            this.displayedRecords = [];  
            this.hasMore = true;  
            this.loadMore();  
        },  
  
        loadMore() {  
            const start = (this.page - 1) * this.pageSize;  
            const end = this.page * this.pageSize;  
            const nextBatch = this.filteredRecords.slice(start, end);  
              
            if (nextBatch.length > 0) {  
                this.displayedRecords = [...this.displayedRecords, ...nextBatch];  
                this.page++;  
            }  
              
            this.hasMore = this.displayedRecords.length < this.filteredRecords.length;  
        },  
  
        formatBalls(item) {  
            if (!item || !item.openCode) return [];  
            const codes = item.openCode.split(',');  
            const waves = item.wave.split(',');  
            const zodiacs = item.zodiac.split(',');  
            return codes.map((code, i) => ({  
                num: code,  
                color: waves[i],  
                zodiac: zodiacs[i]  
            }));  
        }  
    }  
}  
</script>  
</body>  
</html>  
