<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>澳门六合彩 · 分析高亮版</title>

<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<style>
[x-cloak]{display:none}

/* ===== 球体 ===== */
.ball{
  width:36px;height:36px;
  border-radius:9999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-size:14px;
  color:#fff;
}
.bg-red{background:#e53935}
.bg-blue{background:#1e88e5}
.bg-green{background:#43a047}

.special{
  width:42px;height:42px;
  font-size:16px;
  box-shadow:0 0 0 3px #fbbf24;
}

.zodiac{
  font-size:10px;
  color:#6b7280;
  margin-top:2px;
}

.history-row:hover{
  background:#f9fafb;
}
</style>
</head>

<body class="bg-slate-100">

<div x-data="lotteryApp()" x-init="init()" class="max-w-md mx-auto min-h-screen bg-white">

<!-- ===== 顶部 ===== -->
<header class="sticky top-0 z-40 bg-indigo-700 text-white px-4 py-3 flex justify-between items-center shadow">
  <div>
    <h1 class="font-black text-lg tracking-tight">MACAU LOTTO</h1>
    <p class="text-[10px] opacity-70">分析高亮视图</p>
  </div>
  <select x-model="selectedYear" @change="resetPagination()"
    class="bg-indigo-600 text-xs px-2 py-1 rounded outline-none">
    <template x-for="y in years" :key="y">
      <option :value="y" x-text="y+'年'"></option>
    </template>
  </select>
</header>

<!-- ===== 加载 ===== -->
<div x-show="loading" class="py-24 text-center text-gray-400">
  <div class="animate-spin w-8 h-8 mx-auto mb-3 border-4 border-indigo-500 border-t-transparent rounded-full"></div>
  正在加载开奖数据
</div>

<!-- ===== 主体 ===== -->
<div x-show="!loading" x-cloak class="p-4 space-y-6">

<!-- ===== 最新一期 ===== -->
<template x-if="filteredRecords.length">
<div class="rounded-2xl border border-indigo-200 shadow-sm overflow-hidden">

  <div class="bg-indigo-50 px-4 py-2 flex justify-between items-center">
    <div class="font-bold text-indigo-700 text-sm">
      第 <span x-text="filteredRecords[0].expect"></span> 期 · 最新
    </div>
    <div class="text-[10px] text-gray-500"
      x-text="filteredRecords[0].openTime"></div>
  </div>

  <div class="p-4 flex items-center justify-between">
    <template x-for="(ball,i) in formatBalls(filteredRecords[0])" :key="i">
      <div class="flex items-center">
        <template x-if="i===6">
          <span class="mx-2 text-gray-300 font-bold">+</span>
        </template>
        <div class="flex flex-col items-center">
          <div
            :class="[
              'ball',
              'bg-'+ball.color,
              i===6?'special':'',
              ballDim(ball,i)?'opacity-20':'opacity-100'
            ]"
            x-text="ball.num">
          </div>
          <span class="zodiac" x-text="ball.zodiac"></span>
        </div>
      </div>
    </template>
  </div>

</div>
</template>

<!-- ===== 分析控制面板 ===== -->
<div class="bg-slate-50 border rounded-xl p-3 space-y-3">

  <div class="text-xs font-bold text-gray-500 tracking-widest">
    ANALYSIS FILTER
  </div>

  <!-- 生肖 -->
  <div class="flex flex-wrap gap-2">
    <span class="text-xs text-gray-400 w-full">生肖</span>
    <template x-for="z in ['鼠','牛','虎','兔','龙','蛇','马','羊','猴','鸡','狗','猪']">
      <button
        @click="toggleZodiac(z)"
        :class="highlightZodiac===z?'bg-indigo-600 text-white':'bg-white text-gray-600'"
        class="px-2 py-1 rounded text-xs border">
        <span x-text="z"></span>
      </button>
    </template>
  </div>

  <!-- 波色 -->
  <div class="flex gap-2 items-center">
    <span class="text-xs text-gray-400 w-10">波色</span>
    <button @click="toggleWave('red')"
      :class="highlightWave==='red'?'bg-red-500 text-white':'bg-white'"
      class="px-2 py-1 rounded text-xs border">红</button>
    <button @click="toggleWave('blue')"
      :class="highlightWave==='blue'?'bg-blue-500 text-white':'bg-white'"
      class="px-2 py-1 rounded text-xs border">蓝</button>
    <button @click="toggleWave('green')"
      :class="highlightWave==='green'?'bg-green-500 text-white':'bg-white'"
      class="px-2 py-1 rounded text-xs border">绿</button>
  </div>

  <!-- 位置 -->
  <div class="flex flex-wrap gap-2">
    <span class="text-xs text-gray-400 w-full">位置</span>
    <template x-for="i in 7">
      <button
        @click="toggleIndex(i-1)"
        :class="highlightIndex===i-1?'bg-indigo-500 text-white':'bg-white text-gray-600'"
        class="px-2 py-1 rounded text-xs border">
        第<span x-text="i"></span>位
      </button>
    </template>
  </div>

  <button @click="clearHighlight()" class="text-xs text-gray-400 underline">
    清除高亮
  </button>

</div>

<!-- ===== 历史记录 ===== -->
<h2 class="text-xs text-gray-400 tracking-widest font-bold">HISTORY</h2>

<div class="space-y-2">
<template x-for="(item,index) in displayedRecords" :key="item.expect">
<div x-show="index!==0" class="history-row p-3 rounded-lg border border-gray-100">

  <div class="flex justify-between items-center mb-2">
    <div class="text-xs font-bold text-gray-500">
      第 <span x-text="item.expect"></span> 期
    </div>
    <div class="text-[10px] text-gray-300"
      x-text="item.openTime.split(' ')[0]"></div>
  </div>

  <div class="flex items-center justify-between">
    <template x-for="(ball,i) in formatBalls(item)" :key="i">
      <div class="flex items-center">
        <template x-if="i===6">
          <span class="mx-1 text-gray-300">+</span>
        </template>
        <div class="flex flex-col items-center scale-90">
          <div
            :class="[
              'ball',
              'bg-'+ball.color,
              ballDim(ball,i)?'opacity-20':'opacity-100'
            ]"
            x-text="ball.num">
          </div>
          <span class="zodiac" x-text="ball.zodiac"></span>
        </div>
      </div>
    </template>
  </div>

</div>
</template>
</div>

<div id="infinite-sentinel" class="py-6 text-center text-xs text-gray-400">
  <template x-if="hasMore">加载中…</template>
  <template x-if="!hasMore">— 已到底 —</template>
</div>

</div>
</div>

<script>
function lotteryApp(){
return {
loading:true,
allRecords:[],
filteredRecords:[],
displayedRecords:[],
selectedYear:new Date().getFullYear().toString(),
years:['2025','2024','2023','2022','2021','2020'],
page:1,pageSize:15,hasMore:true,

highlightZodiac:null,
highlightWave:null,
highlightIndex:null,

toggleZodiac(z){this.highlightZodiac=this.highlightZodiac===z?null:z},
toggleWave(w){this.highlightWave=this.highlightWave===w?null:w},
toggleIndex(i){this.highlightIndex=this.highlightIndex===i?null:i},
clearHighlight(){this.highlightZodiac=this.highlightWave=this.highlightIndex=null},

ballDim(ball,index){
if(this.highlightZodiac && ball.zodiac!==this.highlightZodiac) return true
if(this.highlightWave && ball.color!==this.highlightWave) return true
if(this.highlightIndex!==null && index!==this.highlightIndex) return true
return false
},

async init(){
const res=await fetch('data.json?t='+Date.now())
this.allRecords=await res.json()
this.resetPagination()
this.$nextTick(()=>{
const ob=new IntersectionObserver(e=>{
if(e[0].isIntersecting&&!this.loading&&this.hasMore){this.loadMore()}
},{rootMargin:'100px'})
ob.observe(document.getElementById('infinite-sentinel'))
})
this.loading=false
},

resetPagination(){
this.filteredRecords=this.allRecords.filter(i=>i.openTime.includes(this.selectedYear))
this.page=1
this.displayedRecords=[]
this.hasMore=this.filteredRecords.length>0
this.loadMore()
},

loadMore(){
const s=(this.page-1)*this.pageSize
const e=this.page*this.pageSize
this.displayedRecords.push(...this.filteredRecords.slice(s,e))
this.page++
this.hasMore=this.displayedRecords.length<this.filteredRecords.length
},

formatBalls(item){
const c=item.openCode.split(',')
const w=item.wave.split(',')
const z=item.zodiac.split(',')
return c.map((n,i)=>({num:n,color:w[i],zodiac:z[i]}))
}
}}
</script>

</body>
</html>
