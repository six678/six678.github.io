<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>澳门六合彩</title>

<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<style>
[x-cloak]{display:none}
.ball{
  width:36px;height:36px;border-radius:9999px;
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:14px;color:#fff;
}
.bg-red{background:#e53935}
.bg-blue{background:#1e88e5}
.bg-green{background:#43a047}
.special{
  width:42px;height:42px;font-size:16px;
  box-shadow:0 0 0 3px #fbbf24;
}
.zodiac{font-size:10px;color:#6b7280;margin-top:2px}
.stat-card{
  background:#f8fafc;border:1px solid #e5e7eb;
  border-radius:12px;padding:12px;
}
.stat-title{
  font-size:11px;color:#6b7280;
  letter-spacing:.15em;font-weight:700;
}
.stat-value{font-size:20px;font-weight:900}
</style>
</head>

<body class="bg-slate-100">

<div x-data="lotteryApp()" x-init="init()" class="max-w-md mx-auto min-h-screen bg-white">

<header class="sticky top-0 z-40 bg-indigo-700 text-white px-4 py-3 flex justify-between items-center shadow">
  <div>
    <h1 class="font-black text-lg">澳门六合彩</h1>
    <p class="text-[10px] opacity-70">分析工具 · 按期命中</p>
  </div>
  <select x-model="selectedYear" @change="resetPagination()"
    class="bg-indigo-600 text-xs px-2 py-1 rounded">
    <template x-for="y in years">
      <option :value="y" x-text="y+'年'"></option>
    </template>
  </select>
</header>

<div x-show="loading" class="py-24 text-center text-gray-400">
  <div class="animate-spin w-8 h-8 mx-auto mb-3 border-4 border-indigo-500 border-t-transparent rounded-full"></div>
  加载中…
</div>

<div x-show="!loading" x-cloak class="p-4 space-y-6">

<!-- 最新一期 -->
<!-- <template x-if="filteredRecords.length">
<div class="rounded-2xl border border-indigo-200 shadow-sm overflow-hidden">
  <div class="bg-indigo-50 px-4 py-2 flex justify-between">
    <b>第 <span x-text="filteredRecords[0].expect"></span> 期</b>
    <span class="text-xs text-gray-400" x-text="filteredRecords[0].openTime"></span>
  </div>
  <div class="p-4 flex justify-between">
    <template x-for="(ball,i) in formatBalls(filteredRecords[0])">
      <div class="flex items-center">
        <template x-if="i===6"><span class="mx-2">+</span></template>
        <div class="flex flex-col items-center">
          <div
            :class="[
              'ball','bg-'+ball.color,
              i===6?'special':'',
              ballDim(ball,i)?'opacity-20':''
            ]"
            x-text="ball.num"></div>
          <span class="zodiac" x-text="ball.zodiac"></span>
        </div>
      </div>
    </template>
  </div>
</div>
</template> -->

<!-- 控制面板 -->
<div class="bg-slate-50 border rounded-xl p-3 space-y-3">
  <div class="stat-title">条件选择</div>

  <div class="flex flex-wrap gap-2">
    <template x-for="z in zodiacs">
      <button @click="toggleZodiac(z)"
        :class="highlightZodiacs.includes(z)
          ? 'bg-indigo-600 text-white'
          : 'bg-white text-gray-600'"
        class="px-2 py-1 text-xs rounded border" x-text="z"></button>
    </template>
  </div>

  <div class="flex gap-2">
    <button @click="toggleWave('red')"
      :class="highlightWaves.includes('red')
        ? 'bg-red-500 text-white'
        : 'bg-white text-gray-600'"
      class="px-2 py-1 text-xs border rounded">红</button>
    <button @click="toggleWave('blue')"
      :class="highlightWaves.includes('blue')
        ? 'bg-blue-500 text-white'
        : 'bg-white text-gray-600'"
      class="px-2 py-1 text-xs border rounded">蓝</button>
    <button @click="toggleWave('green')"
      :class="highlightWaves.includes('green')
        ? 'bg-green-500 text-white'
        : 'bg-white text-gray-600'"
      class="px-2 py-1 text-xs border rounded">绿</button>
  </div>

  <div class="flex flex-nowrap justify-between">
    <template x-for="i in 7">
      <button @click="toggleIndex(i-1)"
        :class="highlightIndexes.includes(i-1)
          ? 'bg-indigo-500 text-white'
          : 'bg-white text-gray-600'"
        class="px-2 py-1 text-xs rounded border">
        第<span x-text="i"></span>位
      </button>
    </template>
  </div>

  <button @click="clearHighlight()" class="text-xs underline text-gray-400">
    清除所有条件
  </button>
</div>

<!-- 命中统计（按期） -->
<div class="grid grid-cols-2 gap-3">
  <div class="stat-card">
    <div class="stat-title">命中率（近30期 · 按期）</div>
    <div class="stat-value"><span x-text="hitStats().rate"></span>%</div>
    <div class="text-xs text-gray-400">
      命中 <span x-text="hitStats().hit"></span> /
      <span x-text="hitStats().total"></span> 期
    </div>
  </div>
  <div class="stat-card">
    <div class="stat-title">特码命中期数</div>
    <div class="stat-value" x-text="hitStats().specialHit"></div>
  </div>
</div>

<!-- 历史 -->
<div class="space-y-2">
<template x-for="(item,index) in displayedRecords">
<div class="border rounded p-3">
  <div class="flex justify-between text-xs text-gray-400 mb-2">
    <span>第 <span x-text="item.expect"></span> 期</span>
    <span x-text="item.openTime.split(' ')[0]"></span>
  </div>
  <div class="flex justify-between">
    <template x-for="(ball,i) in formatBalls(item)">
      <div class="flex items-center">
        <template x-if="i===6"><span class="mx-1">+</span></template>
        <div class="flex flex-col items-center">
          <div
            :class="[
              'ball','bg-'+ball.color,
              ballDim(ball,i)?'opacity-20':''
            ]"
            x-text="ball.num"></div>
          <span class="zodiac" x-text="ball.zodiac"></span>
        </div>
      </div>
    </template>
  </div>
</div>
</template>
</div>

<div id="infinite-sentinel" class="py-6 text-center text-xs text-gray-400">
  <template x-if="hasMore">加载中…</template>
  <template x-if="!hasMore">— 已到底 —</template>
</div>

</div>
</div>

<script>
function lotteryApp(){
return {
loading:true,
analysisRange:30,
zodiacs:['鼠', '牛', '虎', '兔', '龍', '蛇', '馬', '羊', '猴', '雞', '狗', '豬'],

highlightZodiacs:[],
highlightWaves:[],
highlightIndexes:[],

allRecords:[],filteredRecords:[],displayedRecords:[],
selectedYear:new Date().getFullYear().toString(),
years:['2025','2024','2023','2022','2021','2020'],
page:1,pageSize:15,hasMore:true,

toggleZodiac(z){
  this.highlightZodiacs.includes(z)
    ? this.highlightZodiacs=this.highlightZodiacs.filter(x=>x!==z)
    : this.highlightZodiacs.push(z)
},
toggleWave(w){
  this.highlightWaves.includes(w)
    ? this.highlightWaves=this.highlightWaves.filter(x=>x!==w)
    : this.highlightWaves.push(w)
},
toggleIndex(i){
  this.highlightIndexes.includes(i)
    ? this.highlightIndexes=this.highlightIndexes.filter(x=>x!==i)
    : this.highlightIndexes.push(i)
},
clearHighlight(){
  this.highlightZodiacs=[]
  this.highlightWaves=[]
  this.highlightIndexes=[]
},

ballDim(b,i){
  if(this.highlightZodiacs.length && !this.highlightZodiacs.includes(b.zodiac)) return true
  if(this.highlightWaves.length && !this.highlightWaves.includes(b.color)) return true
  if(this.highlightIndexes.length && !this.highlightIndexes.includes(i)) return true
  return false
},

/* ⭐ 按“期”统计命中率 ⭐ */
hitStats(){
  const records=this.filteredRecords.slice(0,this.analysisRange)
  let hit=0
  let specialHit=0

  records.forEach(r=>{
    let periodHit=false
    this.formatBalls(r).forEach((b,i)=>{
      const match =
        (!this.highlightZodiacs.length || this.highlightZodiacs.includes(b.zodiac)) &&
        (!this.highlightWaves.length || this.highlightWaves.includes(b.color)) &&
        (!this.highlightIndexes.length || this.highlightIndexes.includes(i))

      if(match){
        periodHit=true
        if(i===6) specialHit++
      }
    })
    if(periodHit) hit++
  })

  return{
    total:records.length,
    hit,
    rate:records.length?((hit/records.length)*100).toFixed(1):0,
    specialHit
  }
},

async init(){
  const res=await fetch('data.json?t='+Date.now())
  this.allRecords=await res.json()
  this.resetPagination()
  this.$nextTick(()=>{
    new IntersectionObserver(e=>{
      if(e[0].isIntersecting&&this.hasMore)this.loadMore()
    },{rootMargin:'100px'}).observe(
      document.getElementById('infinite-sentinel')
    )
  })
  this.loading=false
},

resetPagination(){
  this.filteredRecords=this.allRecords.filter(
    i=>i.openTime.includes(this.selectedYear)
  )
  this.page=1
  this.displayedRecords=[]
  this.hasMore=true
  this.loadMore()
},

loadMore(){
  const s=(this.page-1)*this.pageSize
  const e=this.page*this.pageSize
  this.displayedRecords.push(
    ...this.filteredRecords.slice(s,e)
  )
  this.page++
  this.hasMore=this.displayedRecords.length<this.filteredRecords.length
},

formatBalls(item){
  const c=item.openCode.split(',')
  const w=item.wave.split(',')
  const z=item.zodiac.split(',')
  return c.map((n,i)=>({
    num:n,
    color:w[i],
    zodiac:z[i]
  }))
}
}}
</script>

</body>
</html>
