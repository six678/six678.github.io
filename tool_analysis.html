<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂéÜÂè≤ÂàÜÊûê - 158‰πùÁÇπÂçä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2c3e50',
                        accent: '#3498db',
                        bg: '#f4f7f6',
                        red: '#e74c3c',
                        green: '#2ecc71',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"SF Pro Text"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                        mono: ['Monaco', 'Courier New', 'monospace'],
                    },
                    zIndex: {
                        'menu-overlay': '1000',
                        'header': '1001',
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        body {
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }

        .pop-menu {
            animation: scaleIn 0.2s ease forwards;
            transform-origin: top right;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .ball {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }

        .ball-red {
            background: linear-gradient(135deg, #ff7675, #d63031);
        }

        .ball-blue {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .ball-green {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .special {
            transform: scale(1.15);
            box-shadow: 0 0 0 2px #f1c40f, 0 4px 8px rgba(0, 0, 0, 0.15);
            position: relative;
            z-index: 10;
        }
    </style>
</head>

<body class="bg-bg text-gray-700 pb-10">

    <div x-data="lotteryApp()" x-init="init()" class="max-w-md mx-auto min-h-screen">

        <!-- Header -->
        <header
            class="sticky top-0 z-header bg-primary text-white h-[50px] px-4 flex justify-between items-center shadow-md">
            <div class="flex items-center w-[60px]">
                <a href="index.html"
                    class="w-9 h-9 flex items-center justify-center rounded-full active:bg-white/20 transition-colors text-xl">üè†</a>
            </div>
            <div class="font-bold text-base tracking-wide">ÂéÜÂè≤ÂàÜÊûê</div>
            <div class="flex items-center justify-end w-[60px] relative">
                <div class="w-9 h-9 flex items-center justify-center rounded-full active:bg-white/20 transition-colors text-xl cursor-pointer"
                    onclick="toggleMenu()">‚∏¨</div>

                <!-- Dropdown Menu -->
                <div class="pop-menu absolute top-[45px] right-0 w-40 bg-white rounded-xl shadow-2xl p-2 hidden flex-col border border-gray-100 z-50"
                    id="navMenu">
                    <a href="index.html"
                        class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 rounded-lg active:bg-gray-50">
                        <span class="w-5 text-center">üè†</span> È¶ñÈ°µÈó®Êà∑
                    </a>
                    <a href="tool_filter.html"
                        class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 rounded-lg active:bg-gray-50">
                        <span class="w-5 text-center">üìä</span> ÈÄâÂè∑Â∑•ÂÖ∑
                    </a>
                    <a href="tool_analysis.html"
                        class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-accent bg-blue-50 rounded-lg">
                        <span class="w-5 text-center">üõ°Ô∏è</span> ÂéÜÂè≤ÂàÜÊûê
                    </a>
                    <a href="live.html"
                        class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 rounded-lg active:bg-gray-50">
                        <span class="w-5 text-center">üî¥</span> ÂºÄÂ•ñÁõ¥Êí≠
                    </a>
                </div>
            </div>
        </header>

        <!-- Overlay -->
        <div class="fixed inset-0 z-menu-overlay hidden" id="menuOverlay" onclick="toggleMenu()"></div>

        <!-- Loading State -->
        <div x-show="loading" class="py-32 text-center text-gray-400">
            <div
                class="animate-spin w-10 h-10 mx-auto mb-4 border-4 border-accent border-t-transparent rounded-full opacity-80">
            </div>
            <span class="text-xs font-medium tracking-wide">Ê≠£Âú®ÂêåÊ≠•Êï∞ÊçÆ...</span>
        </div>

        <!-- Main Content -->
        <div x-show="!loading" x-cloak class="p-4 space-y-5 animate-fade-in">

            <!-- Filter Card -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-50 space-y-5">
                <div class="flex justify-between items-center pb-3 border-b border-gray-100">
                    <div class="font-bold text-gray-700 flex items-center gap-2">
                        <span class="text-lg">üéØ</span> Ê®°ÊãüÊù°‰ª∂
                    </div>
                    <div class="relative">
                        <select x-model="selectedYear" @change="resetPagination()"
                            class="appearance-none bg-blue-50 text-accent text-xs pl-3 pr-8 py-1.5 rounded-lg font-bold outline-none">
                            <template x-for="y in years">
                                <option :value="y" x-text="y+'Âπ¥'"></option>
                            </template>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-accent">
                            <svg class="fill-current h-3 w-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Zodiac Filter -->
                <div>
                    <div class="text-[11px] text-gray-400 uppercase tracking-wider font-bold mb-2">ÁîüËÇñÁ≠õÈÄâ</div>
                    <div class="grid grid-cols-6 gap-2">
                        <template x-for="z in zodiacs">
                            <button @click="toggleZodiac(z)"
                                :class="highlightZodiacs.includes(z) ? 'bg-primary text-white border-primary' : 'bg-white text-gray-500 border-gray-200'"
                                class="h-8 flex items-center justify-center text-xs rounded-lg border shadow-sm transition-all active:scale-95"
                                x-text="z"></button>
                        </template>
                    </div>
                </div>

                <!-- Number Filter -->
                <div>
                    <div class="text-[11px] text-gray-400 uppercase tracking-wider font-bold mb-2">Âè∑Á†ÅÁ≠õÈÄâ</div>
                    <div class="grid grid-cols-7 gap-1.5">
                        <template x-for="n in 49">
                            <button @click="toggleNumber(n)"
                                :class="highlightNumbers.includes(n) ? 'bg-primary text-white border-primary font-bold' : 'bg-white text-gray-400 border-gray-100'"
                                class="py-1.5 text-[10px] rounded border transition-all" x-text="n < 10 ? '0'+n : n">
                            </button>
                        </template>
                    </div>
                </div>

                <!-- Wave & Position Filter -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <div class="text-[11px] text-gray-400 uppercase tracking-wider font-bold mb-2">Ê≥¢Ëâ≤</div>
                        <div class="flex gap-1">
                            <button @click="toggleWave('red')"
                                :class="highlightWaves.includes('red') ? 'bg-[#ff7675] text-white border-transparent' : 'bg-white text-gray-500 border-gray-200'"
                                class="flex-1 py-1.5 text-xs border rounded transition">Á∫¢</button>
                            <button @click="toggleWave('blue')"
                                :class="highlightWaves.includes('blue') ? 'bg-[#74b9ff] text-white border-transparent' : 'bg-white text-gray-500 border-gray-200'"
                                class="flex-1 py-1.5 text-xs border rounded transition">Ëìù</button>
                            <button @click="toggleWave('green')"
                                :class="highlightWaves.includes('green') ? 'bg-[#55efc4] text-white border-transparent' : 'bg-white text-gray-500 border-gray-200'"
                                class="flex-1 py-1.5 text-xs border rounded transition">Áªø</button>
                        </div>
                    </div>
                    <div>
                        <div class="text-[11px] text-gray-400 uppercase tracking-wider font-bold mb-2">‰ΩçÁΩÆ</div>
                        <div class="flex gap-1 overflow-x-auto">
                            <template x-for="i in 7">
                                <button @click="toggleIndex(i-1)"
                                    :class="highlightIndexes.includes(i-1) ? 'bg-primary text-white border-primary' : 'bg-white text-gray-500 border-gray-200'"
                                    class="flex-1 py-1.5 text-[10px] min-w-[20px] rounded border transition"
                                    x-text="i"></button>
                            </template>
                        </div>
                    </div>
                </div>

                <div class="pt-2 border-t border-dashed border-gray-100 text-center">
                    <button @click="clearHighlight()"
                        class="text-xs font-bold text-accent px-4 py-2 hover:bg-blue-50 rounded transition">
                        ‚Ü∫ ÈáçÁΩÆÊâÄÊúâÊù°‰ª∂
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-16 h-16 bg-blue-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>
                    <div class="relative z-10">
                        <div class="text-[11px] text-gray-400 uppercase tracking-wider font-bold mb-1">ÁªºÂêàÂëΩ‰∏≠Áéá</div>
                        <div class="flex items-baseline gap-1 mt-1">
                            <span class="text-2xl font-extrabold text-primary" x-text="hitStats().rate"></span>
                            <span class="text-sm font-bold text-gray-400">%</span>
                        </div>
                        <div class="text-[10px] text-gray-400 mt-2 bg-gray-50 inline-block px-2 py-0.5 rounded">
                            Ëøë <span x-text="analysisRange"></span> Êúü‰∏≠ <span x-text="hitStats().hit"></span>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-50 relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-16 h-16 bg-red-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>
                    <div class="relative z-10">
                        <div class="text-[11px] text-gray-400 uppercase tracking-wider font-bold mb-1">ÁâπÁ†ÅÂëΩ‰∏≠</div>
                        <div class="text-2xl font-extrabold text-red mt-1" x-text="hitStats().specialHit"></div>
                        <div class="text-[10px] text-gray-400 mt-2">Âú®Á¨¨7‰ΩçÂá∫Áé∞Ê¨°Êï∞</div>
                    </div>
                </div>
            </div>

            <!-- Records List -->
            <div class="space-y-3 pb-8">
                <template x-for="(item,index) in displayedRecords">
                    <div
                        class="bg-white rounded-2xl p-3 shadow-sm border border-gray-50 transition-transform active:scale-[0.99]">
                        <div
                            class="flex justify-between items-center text-xs text-gray-400 mb-3 pb-2 border-b border-gray-50">
                            <span class="font-bold text-gray-600 bg-gray-100 px-2 py-1 rounded-md">Á¨¨ <span
                                    x-text="item.expect"></span> Êúü</span>
                            <span x-text="item.openTime.split(' ')[0]"></span>
                        </div>
                        <div class="flex justify-between px-1">
                            <template x-for="(ball,i) in formatBalls(item)">
                                <div class="flex items-center">
                                    <template x-if="i===6"><span
                                            class="mx-1 text-gray-300 font-light text-lg">+</span></template>
                                    <div class="flex flex-col items-center gap-1">
                                        <div :class="[
                                            'ball w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm text-white',
                                            'ball-'+ball.color,
                                            i===6?'special':'',
                                            ballDim(ball,i)?'opacity-10 grayscale scale-90':''
                                        ]" x-text="ball.num"></div>
                                        <span class="text-[10px] text-gray-400 font-medium mt-1"
                                            x-text="ball.zodiac"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Infinite Scroll Sentinel -->
            <div id="infinite-sentinel" class="py-4 text-center">
                <template x-if="hasMore">
                    <div class="flex justify-center items-center gap-2">
                        <span class="h-2 w-2 bg-gray-300 rounded-full animate-bounce"></span>
                        <span class="h-2 w-2 bg-gray-300 rounded-full animate-bounce delay-100"></span>
                        <span class="h-2 w-2 bg-gray-300 rounded-full animate-bounce delay-200"></span>
                    </div>
                </template>
                <template x-if="!hasMore"><span class="text-xs text-gray-300 tracking-widest uppercase">- End
                        -</span></template>
            </div>

        </div>
    </div>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('navMenu');
            const overlay = document.getElementById('menuOverlay');
            menu.classList.toggle('hidden');
            menu.classList.toggle('flex');
            overlay.classList.toggle('hidden');
        }

        function lotteryApp() {
            return {
                loading: true,
                analysisRange: 30,
                zodiacs: ['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæç', 'Ëõá', 'È¶¨', 'Áæä', 'Áå¥', 'Èõû', 'Áãó', 'Ë±¨'],
                highlightZodiacs: [], highlightWaves: [], highlightIndexes: [], highlightNumbers: [],
                allRecords: [], filteredRecords: [], displayedRecords: [],
                selectedYear: new Date().getFullYear().toString(),
                years: ['2025', '2024', '2023', '2022', '2021', '2020'],
                page: 1, pageSize: 15, hasMore: true,

                toggleNumber(n) {
                    this.highlightNumbers.includes(n) ? this.highlightNumbers = this.highlightNumbers.filter(x => x !== n) : this.highlightNumbers.push(n)
                },
                toggleZodiac(z) {
                    this.highlightZodiacs.includes(z) ? this.highlightZodiacs = this.highlightZodiacs.filter(x => x !== z) : this.highlightZodiacs.push(z)
                },
                toggleWave(w) {
                    this.highlightWaves.includes(w) ? this.highlightWaves = this.highlightWaves.filter(x => x !== w) : this.highlightWaves.push(w)
                },
                toggleIndex(i) {
                    this.highlightIndexes.includes(i) ? this.highlightIndexes = this.highlightIndexes.filter(x => x !== i) : this.highlightIndexes.push(i)
                },
                clearHighlight() {
                    this.highlightZodiacs = []; this.highlightWaves = []; this.highlightIndexes = []; this.highlightNumbers = []
                },
                ballDim(b, i) {
                    if (!this.highlightZodiacs.length && !this.highlightWaves.length && !this.highlightIndexes.length && !this.highlightNumbers.length) return false;
                    let matchZodiac = !this.highlightZodiacs.length || this.highlightZodiacs.includes(b.zodiac);
                    let matchWave = !this.highlightWaves.length || this.highlightWaves.includes(b.color);
                    let matchIndex = !this.highlightIndexes.length || this.highlightIndexes.includes(i);
                    let matchNumber = !this.highlightNumbers.length || this.highlightNumbers.includes(parseInt(b.num, 10));
                    return !(matchZodiac && matchWave && matchIndex && matchNumber);
                },
                hitStats() {
                    const records = this.filteredRecords.slice(0, this.analysisRange);
                    let hit = 0; let specialHit = 0;
                    if (!this.highlightZodiacs.length && !this.highlightWaves.length && !this.highlightIndexes.length && !this.highlightNumbers.length) {
                        return { total: records.length, hit: 0, rate: 0, specialHit: 0 };
                    }
                    records.forEach(r => {
                        let periodHit = false;
                        this.formatBalls(r).forEach((b, i) => {
                            const match =
                                (!this.highlightZodiacs.length || this.highlightZodiacs.includes(b.zodiac)) &&
                                (!this.highlightWaves.length || this.highlightWaves.includes(b.color)) &&
                                (!this.highlightIndexes.length || this.highlightIndexes.includes(i)) &&
                                (!this.highlightNumbers.length || this.highlightNumbers.includes(parseInt(b.num, 10)));
                            if (match) { periodHit = true; if (i === 6) specialHit++; }
                        })
                        if (periodHit) hit++;
                    })
                    return { total: records.length, hit, rate: records.length ? ((hit / records.length) * 100).toFixed(1) : 0, specialHit }
                },
                async init() {
                    try {
                        const res = await fetch('data.json?t=' + Date.now());
                        if (!res.ok) throw new Error("Data fetch failed");
                        this.allRecords = await res.json();
                        this.resetPagination();
                        this.$nextTick(() => {
                            const sentinel = document.getElementById('infinite-sentinel');
                            if (sentinel) {
                                new IntersectionObserver(e => {
                                    if (e[0].isIntersecting && this.hasMore) this.loadMore();
                                }, { rootMargin: '200px' }).observe(sentinel);
                            }
                        });
                    } catch (e) { console.error(e); alert("Êó†Ê≥ïÂä†ËΩΩÊï∞ÊçÆÔºåËØ∑Á°Æ‰øùÁõÆÂΩï‰∏ãÊúâ data.json Êñá‰ª∂"); } finally { this.loading = false; }
                },
                resetPagination() {
                    this.filteredRecords = this.allRecords.filter(i => i.openTime.includes(this.selectedYear));
                    this.page = 1; this.displayedRecords = []; this.hasMore = true; this.loadMore();
                },
                loadMore() {
                    const s = (this.page - 1) * this.pageSize; const e = this.page * this.pageSize;
                    const newItems = this.filteredRecords.slice(s, e);
                    if (newItems.length > 0) { this.displayedRecords.push(...newItems); this.page++; }
                    this.hasMore = this.displayedRecords.length < this.filteredRecords.length;
                },
                formatBalls(item) {
                    const c = item.openCode.split(','); const w = item.wave.split(','); const z = item.zodiac.split(',');
                    return c.map((n, i) => ({ num: n, color: w[i], zodiac: z[i] }));
                }
            }
        }
    </script>
</body>

</html>