<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å†å²åˆ†æ - 158930.COM</title>

<script src="https://cdn.tailwindcss.com"></script>
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<style>
    :root {
        --primary: #2c3e50;
        --accent: #3498db;
        --bg-color: #f4f7f6;
    }

    [x-cloak] { display: none !important; }

    body { background-color: var(--bg-color); font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Roboto, Helvetica, Arial, sans-serif; }

    /* === ä¿®å¤é‡ç‚¹ï¼šé®ç½©å±‚è®¾ä¸º 1000 === */
    .menu-overlay {
        position: fixed; inset: 0; z-index: 1000; display: none;
    }
    .pop-menu {
        position: absolute;
        top: 45px;
        right: 0;
        width: 160px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        padding: 8px;
        display: none;
        flex-direction: column;
        transform-origin: top right;
        animation: scaleIn 0.2s ease forwards;
        border: 1px solid rgba(0,0,0,0.05);
    }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    
    .menu-item {
        display: flex; align-items: center; gap: 12px;
        padding: 12px 15px;
        color: #333;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        border-radius: 8px;
        transition: background 0.1s;
    }
    .menu-item:active { background: #f5f7fa; }
    .menu-item.active { color: var(--accent); background: #f0f9ff; }
    .menu-icon { width: 20px; text-align: center; font-size: 16px; }

    .btn-icon-header {
        width: 36px; height: 36px;
        display: flex; align-items: center; justify-content: center;
        border-radius: 50%;
        text-decoration: none;
        color: white;
        font-size: 20px;
        transition: background 0.2s;
        cursor: pointer;
    }
    .btn-icon-header:active { background: rgba(255,255,255,0.2); }

    .ball {
        width: 32px; height: 32px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-weight: 700; font-size: 14px; color: #fff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: all 0.2s;
    }

    .bg-red { background: linear-gradient(135deg, #ff7675, #d63031); }
    .bg-blue { background: linear-gradient(135deg, #74b9ff, #0984e3); }
    .bg-green { background: linear-gradient(135deg, #55efc4, #00b894); }

    .special {
        transform: scale(1.15);
        box-shadow: 0 0 0 2px #f1c40f, 0 4px 8px rgba(0,0,0,0.15);
        position: relative; z-index: 10;
    }

    .zodiac { font-size: 10px; color: #95a5a6; margin-top: 4px; font-weight: 500; }

    .app-card {
        background: white; border-radius: 16px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.03); 
        border: 1px solid rgba(0,0,0,0.02);
    }

    .stat-title {
        font-size: 11px; color: #95a5a6;
        text-transform: uppercase; letter-spacing: 1px; font-weight: 700;
        margin-bottom: 5px;
    }
    .stat-value { font-size: 24px; font-weight: 800; color: var(--primary); }

    .btn-active { background: var(--primary) !important; color: white !important; border-color: var(--primary) !important; }
    
    .record-item { transition: transform 0.2s; }
    .record-item:active { transform: scale(0.99); }
    
    /* ä¿®å¤é‡ç‚¹ï¼šè‡ªå®šä¹‰ z-index */
    .z-top { z-index: 1001 !important; }
</style>
</head>

<body class="text-slate-700 pb-10">

<div x-data="lotteryApp()" x-init="init()" class="max-w-md mx-auto min-h-screen">

    <header class="sticky top-0 z-top bg-[#2c3e50] text-white h-[50px] px-4 flex justify-between items-center shadow-md">
        <div class="flex items-center w-[60px]">
            <a href="index.html" class="btn-icon-header">ğŸ </a>
        </div>
        <div class="font-bold text-base tracking-wide">å†å²åˆ†æ</div>
        <div class="flex items-center justify-end w-[60px] relative">
            <div class="btn-icon-header" onclick="toggleMenu()">â¸¬</div>
            <div class="pop-menu" id="navMenu">
                <a href="index.html" class="menu-item">
                    <span class="menu-icon">ğŸ </span> é¦–é¡µé—¨æˆ·
                </a>
                <a href="tool_filter.html" class="menu-item">
                    <span class="menu-icon">ğŸ“Š</span> é€‰å·å·¥å…·
                </a>
                <a href="tool_analysis.html" class="menu-item active">
                    <span class="menu-icon">ğŸ›¡ï¸</span> å†å²åˆ†æ
                </a>
            </div>
        </div>
    </header>

    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>

    <div x-show="loading" class="py-32 text-center text-gray-400">
        <div class="animate-spin w-10 h-10 mx-auto mb-4 border-4 border-[#3498db] border-t-transparent rounded-full opacity-80"></div>
        <span class="text-xs font-medium tracking-wide">æ­£åœ¨åŒæ­¥æ•°æ®...</span>
    </div>

    <div x-show="!loading" x-cloak class="p-4 space-y-5">

        <div class="app-card p-5 space-y-5">
            <div class="flex justify-between items-center pb-3 border-b border-gray-100">
                <div class="font-bold text-gray-700 flex items-center gap-2">
                    <span class="text-lg">ğŸ¯</span> æ¨¡æ‹Ÿæ¡ä»¶
                </div>
                <div class="relative">
                    <select x-model="selectedYear" @change="resetPagination()"
                        class="appearance-none bg-blue-50 text-blue-600 text-xs pl-3 pr-8 py-1.5 rounded-lg font-bold outline-none">
                        <template x-for="y in years">
                            <option :value="y" x-text="y+'å¹´'"></option>
                        </template>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-blue-600">
                        <svg class="fill-current h-3 w-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div>

            <div>
                <div class="stat-title mb-2">ç”Ÿè‚–ç­›é€‰</div>
                <div class="grid grid-cols-6 gap-2">
                    <template x-for="z in zodiacs">
                        <button @click="toggleZodiac(z)"
                            :class="highlightZodiacs.includes(z) ? 'btn-active' : 'bg-white text-gray-500 border-gray-200'"
                            class="h-8 flex items-center justify-center text-xs rounded-lg border shadow-sm transition-all active:scale-95" 
                            x-text="z"></button>
                    </template>
                </div>
            </div>

            <div>
                <div class="stat-title mb-2">å·ç ç­›é€‰</div>
                <div class="grid grid-cols-7 gap-1.5">
                    <template x-for="n in 49">
                        <button @click="toggleNumber(n)"
                            :class="highlightNumbers.includes(n) ? 'btn-active font-bold' : 'bg-white text-gray-400 border-gray-100'"
                            class="py-1.5 text-[10px] rounded border transition-all"
                            x-text="n < 10 ? '0'+n : n">
                        </button>
                    </template>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <div class="stat-title mb-2">æ³¢è‰²</div>
                    <div class="flex gap-1">
                        <button @click="toggleWave('red')" :class="highlightWaves.includes('red') ? 'bg-[#ff7675] text-white border-transparent' : 'bg-white text-gray-500 border-gray-200'" class="flex-1 py-1.5 text-xs border rounded transition">çº¢</button>
                        <button @click="toggleWave('blue')" :class="highlightWaves.includes('blue') ? 'bg-[#74b9ff] text-white border-transparent' : 'bg-white text-gray-500 border-gray-200'" class="flex-1 py-1.5 text-xs border rounded transition">è“</button>
                        <button @click="toggleWave('green')" :class="highlightWaves.includes('green') ? 'bg-[#55efc4] text-white border-transparent' : 'bg-white text-gray-500 border-gray-200'" class="flex-1 py-1.5 text-xs border rounded transition">ç»¿</button>
                    </div>
                </div>
                <div>
                    <div class="stat-title mb-2">ä½ç½®</div>
                    <div class="flex gap-1 overflow-x-auto">
                        <template x-for="i in 7">
                            <button @click="toggleIndex(i-1)"
                                :class="highlightIndexes.includes(i-1) ? 'btn-active' : 'bg-white text-gray-500 border-gray-200'"
                                class="flex-1 py-1.5 text-[10px] min-w-[20px] rounded border transition" x-text="i"></button>
                        </template>
                    </div>
                </div>
            </div>

            <div class="pt-2 border-t border-dashed border-gray-100 text-center">
                 <button @click="clearHighlight()" class="text-xs font-bold text-[#3498db] px-4 py-2 hover:bg-blue-50 rounded transition">
                    â†º é‡ç½®æ‰€æœ‰æ¡ä»¶
                </button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <div class="app-card p-4 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-16 h-16 bg-blue-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>
                <div class="relative z-10">
                    <div class="stat-title">ç»¼åˆå‘½ä¸­ç‡</div>
                    <div class="flex items-baseline gap-1 mt-1">
                        <span class="stat-value" x-text="hitStats().rate"></span>
                        <span class="text-sm font-bold text-gray-400">%</span>
                    </div>
                    <div class="text-[10px] text-gray-400 mt-2 bg-gray-50 inline-block px-2 py-0.5 rounded">
                        è¿‘ <span x-text="analysisRange"></span> æœŸä¸­ <span x-text="hitStats().hit"></span>
                    </div>
                </div>
            </div>
            <div class="app-card p-4 relative overflow-hidden">
                <div class="absolute right-0 top-0 w-16 h-16 bg-red-50 rounded-bl-full -mr-4 -mt-4 z-0"></div>
                <div class="relative z-10">
                    <div class="stat-title">ç‰¹ç å‘½ä¸­</div>
                    <div class="stat-value text-[#e74c3c] mt-1" x-text="hitStats().specialHit"></div>
                    <div class="text-[10px] text-gray-400 mt-2">åœ¨ç¬¬7ä½å‡ºç°æ¬¡æ•°</div>
                </div>
            </div>
        </div>

        <div class="space-y-3 pb-8">
            <template x-for="(item,index) in displayedRecords">
                <div class="app-card p-3 record-item">
                    <div class="flex justify-between items-center text-xs text-gray-400 mb-3 pb-2 border-b border-gray-50">
                        <span class="font-bold text-gray-600 bg-gray-100 px-2 py-1 rounded-md">ç¬¬ <span x-text="item.expect"></span> æœŸ</span>
                        <span x-text="item.openTime.split(' ')[0]"></span>
                    </div>
                    <div class="flex justify-between px-1">
                        <template x-for="(ball,i) in formatBalls(item)">
                            <div class="flex items-center">
                                <template x-if="i===6"><span class="mx-1 text-gray-300 font-light text-lg">+</span></template>
                                <div class="flex flex-col items-center gap-1">
                                    <div
                                        :class="[
                                            'ball','bg-'+ball.color,
                                            i===6?'special':'',
                                            ballDim(ball,i)?'opacity-10 grayscale scale-90':''
                                        ]"
                                        x-text="ball.num"></div>
                                    <span class="zodiac" x-text="ball.zodiac"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <div id="infinite-sentinel" class="py-4 text-center">
            <template x-if="hasMore">
                <div class="flex justify-center items-center gap-2">
                    <span class="h-2 w-2 bg-gray-300 rounded-full animate-bounce"></span>
                    <span class="h-2 w-2 bg-gray-300 rounded-full animate-bounce delay-100"></span>
                    <span class="h-2 w-2 bg-gray-300 rounded-full animate-bounce delay-200"></span>
                </div>
            </template>
            <template x-if="!hasMore"><span class="text-xs text-gray-300 tracking-widest uppercase">- End -</span></template>
        </div>

    </div>
</div>

<script>
function toggleMenu() {
    const menu = document.getElementById('navMenu');
    const overlay = document.getElementById('menuOverlay');
    if (menu.style.display === 'flex') {
        menu.style.display = 'none';
        overlay.style.display = 'none';
    } else {
        menu.style.display = 'flex';
        overlay.style.display = 'block';
    }
}

function lotteryApp(){
    return {
        loading: true,
        analysisRange: 30, 
        zodiacs: ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾', 'è›‡', 'é¦¬', 'ç¾Š', 'çŒ´', 'é›', 'ç‹—', 'è±¬'],
        highlightZodiacs: [], highlightWaves: [], highlightIndexes: [], highlightNumbers: [],
        allRecords: [], filteredRecords: [], displayedRecords: [],
        selectedYear: new Date().getFullYear().toString(),
        years: ['2025','2024','2023','2022','2021','2020'],
        page: 1, pageSize: 15, hasMore: true,

        toggleNumber(n){
            this.highlightNumbers.includes(n) ? this.highlightNumbers = this.highlightNumbers.filter(x => x !== n) : this.highlightNumbers.push(n)
        },
        toggleZodiac(z){
            this.highlightZodiacs.includes(z) ? this.highlightZodiacs = this.highlightZodiacs.filter(x => x !== z) : this.highlightZodiacs.push(z)
        },
        toggleWave(w){
            this.highlightWaves.includes(w) ? this.highlightWaves = this.highlightWaves.filter(x => x !== w) : this.highlightWaves.push(w)
        },
        toggleIndex(i){
            this.highlightIndexes.includes(i) ? this.highlightIndexes = this.highlightIndexes.filter(x => x !== i) : this.highlightIndexes.push(i)
        },
        clearHighlight(){
            this.highlightZodiacs = []; this.highlightWaves = []; this.highlightIndexes = []; this.highlightNumbers = []
        },
        ballDim(b, i){
            if(!this.highlightZodiacs.length && !this.highlightWaves.length && !this.highlightIndexes.length && !this.highlightNumbers.length) return false;
            let matchZodiac = !this.highlightZodiacs.length || this.highlightZodiacs.includes(b.zodiac);
            let matchWave = !this.highlightWaves.length || this.highlightWaves.includes(b.color);
            let matchIndex = !this.highlightIndexes.length || this.highlightIndexes.includes(i);
            let matchNumber = !this.highlightNumbers.length || this.highlightNumbers.includes(parseInt(b.num, 10));
            return !(matchZodiac && matchWave && matchIndex && matchNumber);
        },
        hitStats(){
            const records = this.filteredRecords.slice(0, this.analysisRange);
            let hit = 0; let specialHit = 0;
            if(!this.highlightZodiacs.length && !this.highlightWaves.length && !this.highlightIndexes.length && !this.highlightNumbers.length) {
                return { total: records.length, hit: 0, rate: 0, specialHit: 0 };
            }
            records.forEach(r => {
                let periodHit = false;
                this.formatBalls(r).forEach((b, i) => {
                    const match = 
                        (!this.highlightZodiacs.length || this.highlightZodiacs.includes(b.zodiac)) &&
                        (!this.highlightWaves.length || this.highlightWaves.includes(b.color)) &&
                        (!this.highlightIndexes.length || this.highlightIndexes.includes(i)) &&
                        (!this.highlightNumbers.length || this.highlightNumbers.includes(parseInt(b.num, 10)));
                    if(match){ periodHit = true; if(i === 6) specialHit++; }
                })
                if(periodHit) hit++;
            })
            return { total: records.length, hit, rate: records.length ? ((hit / records.length) * 100).toFixed(1) : 0, specialHit }
        },
        async init(){
            try {
                const res = await fetch('data.json?t=' + Date.now());
                if(!res.ok) throw new Error("Data fetch failed");
                this.allRecords = await res.json();
                this.resetPagination();
                this.$nextTick(() => {
                    const sentinel = document.getElementById('infinite-sentinel');
                    if(sentinel){
                        new IntersectionObserver(e => {
                            if(e[0].isIntersecting && this.hasMore) this.loadMore();
                        }, { rootMargin: '200px' }).observe(sentinel);
                    }
                });
            } catch(e) { console.error(e); alert("æ— æ³•åŠ è½½æ•°æ®ï¼Œè¯·ç¡®ä¿ç›®å½•ä¸‹æœ‰ data.json æ–‡ä»¶"); } finally { this.loading = false; }
        },
        resetPagination(){
            this.filteredRecords = this.allRecords.filter(i => i.openTime.includes(this.selectedYear));
            this.page = 1; this.displayedRecords = []; this.hasMore = true; this.loadMore();
        },
        loadMore(){
            const s = (this.page - 1) * this.pageSize; const e = this.page * this.pageSize;
            const newItems = this.filteredRecords.slice(s, e);
            if(newItems.length > 0) { this.displayedRecords.push(...newItems); this.page++; }
            this.hasMore = this.displayedRecords.length < this.filteredRecords.length;
        },
        formatBalls(item){
            const c = item.openCode.split(','); const w = item.wave.split(','); const z = item.zodiac.split(',');
            return c.map((n, i) => ({ num: n, color: w[i], zodiac: z[i] }));
        }
    }
}
</script>
</body>
</html>