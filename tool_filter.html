<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…­åˆå½©åŠ©æ‰‹ (äº¤äº’ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --red: #e74c3c;
            --green: #2ecc71;
            --bg: #f4f7f6;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: #333; 
            margin: 0; 
            padding: 10px; 
            touch-action: manipulation; 
        }
        
        /* === é¡¶éƒ¨å¯¼èˆªæ  === */
        .nav-tabs {
            display: flex;
            background: white;
            padding: 5px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 15px;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-size: 16px;
            font-weight: bold;
            color: #7f8c8d;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .nav-item.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .section { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* === ç»Ÿè®¡é¡µé¢æ ·å¼ === */
        textarea.data-input { 
            width: 100%; height: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            box-sizing: border-box; font-family: monospace; font-size: 16px; -webkit-appearance: none; resize: none;
        }
        
        .action-bar { display: grid; grid-template-columns: 1fr 1fr 0.6fr; gap: 8px; margin-top: 10px; }
        .btn-stat { height: 44px; border: none; border-radius: 8px; font-weight: bold; font-size: 15px; color: white; cursor: pointer; }
        .btn-run { background: var(--green); }
        .btn-copy { background: var(--accent); display: none; }
        .btn-clear { background: #95a5a6; color: white; }

        .stats-container { margin-top: 15px; background: #fafafa; border-radius: 8px; padding: 10px; border: 1px solid #eee; display: none; }
        .stat-group { margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px dashed #eee; }
        .stat-group:last-child { border-bottom: none; }
        .stat-header { display: flex; justify-content: space-between; font-size: 13px; color: #666; margin-bottom: 4px; }
        .stat-badge { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 12px; }
        .stat-nums { font-family: monospace; font-size: 17px; color: #333; line-height: 1.4; word-break: break-all; }
        .hot-num { color: var(--red); font-weight: bold; }

        /* === é€‰å·å·¥å…·é¡µé¢æ ·å¼ === */
        .settings-bar { 
            display: flex; align-items: center; justify-content: space-between;
            background: #fff3cd; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 14px;
        }

        /* ç»“æœå±•ç¤ºåŒºåŸŸ */
        .result-area { 
            margin-bottom: 20px; 
            padding-bottom: 20px; 
            border-bottom: 2px dashed #eee; 
        }
        .result-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;
        }
        .result-title {
            font-size: 1.1rem; color: var(--primary); font-weight: bold; margin: 0;
        }
        .btn-copy-sm {
            background: var(--accent); color: white; border: none; padding: 6px 12px; 
            border-radius: 6px; font-size: 13px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 4px;
        }
        .ball-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; justify-items: center; }
        .ball {
            display: flex; justify-content: center; align-items: center;
            width: 38px; height: 38px; border-radius: 50%;
            font-weight: bold; color: white; font-size: 15px;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.2); transition: all 0.3s;
        }
        .ball.red { background-color: var(--red); }
        .ball.blue { background-color: var(--accent); }
        .ball.green { background-color: var(--green); }
        
        .ball.disabled { 
            opacity: 0.15; 
            filter: grayscale(100%); 
            transform: scale(0.7); 
            background-color: #ccc !important;
            box-shadow: none;
        }

        /* è¿‡æ»¤æ¡ä»¶ç»„ */
        .filter-group { margin-bottom: 15px; }
        .filter-label { display: block; font-weight: bold; margin-bottom: 8px; color: #555; font-size: 14px; }
        
        .btn-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 8px; }
        .filter-btn {
            border: 1px solid #eee; background: white; padding: 10px 0; border-radius: 6px; 
            font-size: 14px; color: #444; transition: all 0.2s;
        }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); font-weight: bold; }

        /* è‡ªå®šä¹‰å¤šè¡Œè¾“å…¥ & æŒ‰é’®ç»„æ ·å¼ */
        .custom-textarea {
            width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;
            box-sizing: border-box; font-family: monospace; font-size: 15px; resize: none;
            background: #fafafa; margin-bottom: 10px;
        }
        .custom-textarea:focus { border-color: var(--accent); background: white; outline: none; }
        
        .custom-action-bar {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .btn-apply {
            background: var(--primary); color: white; border: none; border-radius: 8px;
            padding: 12px; font-weight: bold; font-size: 15px; cursor: pointer;
        }
        .btn-reset {
            background: var(--red); color: white; border: none; border-radius: 8px;
            padding: 12px; font-weight: bold; font-size: 15px; cursor: pointer;
        }
    </style>
</head>
<body>

    <nav class="nav-tabs">
        <div class="nav-item active" onclick="switchTab('stats')">ğŸ“Š å·ç ç»Ÿè®¡</div>
        <div class="nav-item" onclick="switchTab('filter')">ğŸ›¡ï¸ é€‰å·å·¥å…·</div>
    </nav>

    <div id="tab-stats" class="tab-content active">
        <div class="section">
            <h2 style="font-size:1.1rem; text-align:center; color:var(--primary); margin-bottom:15px;">å†å²æ•°æ®å½•å…¥</h2>
            <textarea id="historyInput" class="data-input" placeholder="ç›´æ¥ç²˜è´´å¼€å¥–è®°å½•ï¼Œä¾‹å¦‚ï¼š&#10;001æœŸ 01 05 12...&#10;002æœŸ 18 20 33..."></textarea>
            
            <div class="action-bar">
                <button class="btn-stat btn-run" onclick="analyzeHistory()">â–¶ å¼€å§‹ç»Ÿè®¡</button>
                <button id="btnCopy" class="btn-stat btn-copy" onclick="copyStats()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                <button class="btn-stat btn-clear" onclick="clearStats()">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
        </div>

        <div id="statsOutput" class="stats-container">
            </div>
    </div>

    <div id="tab-filter" class="tab-content">
        <div class="section">
            
            <div class="settings-bar">
                <span>âš™ï¸ <strong>ä»Šå¹´æ˜¯</strong> (è®¾å®š1å·ç”Ÿè‚–)</span>
                <select id="yearZodiac" onchange="initApp()" style="font-size:16px; padding:4px;">
                    </select>
            </div>

            <div class="result-area">
                <div class="result-header">
                    <h2 class="result-title">ğŸ¯ å‰©ä½™ (<span id="result-count" style="color:var(--accent)">49</span>ä¸ª)</h2>
                    <button class="btn-copy-sm" id="btnCopyResult" onclick="copyFilterResults()">ğŸ“‹ å¤åˆ¶å·ç </button>
                </div>
                <div id="numbersGrid" class="ball-grid"></div>
            </div>

            <div class="filter-group">
                <span class="filter-label">âœï¸ è‡ªå®šä¹‰æ’é™¤ (æ”¯æŒå¤šè¡Œ/ç©ºæ ¼):</span>
                <textarea id="customFilterInput" class="custom-textarea" placeholder="åœ¨æ­¤ç²˜è´´å·ç æˆ–ç”Ÿè‚–ï¼Œä¾‹å¦‚ï¼š&#10;01 05 49&#10;é¼  é¾™ è›‡&#10;(ç‚¹å‡»ä¸‹æ–¹æ’é™¤æŒ‰é’®ç”Ÿæ•ˆ)"></textarea>
                <div class="custom-action-bar">
                    <button class="btn-apply" onclick="applyCustomFilter()">ğŸš« æ‰§è¡Œæ’é™¤</button>
                    <button class="btn-reset" onclick="resetFilters()">ğŸ”„ é‡ç½®æ‰€æœ‰æ¡ä»¶</button>
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">æŒ‰å¤´æ•°æ’é™¤:</span>
                <div class="btn-grid" style="grid-template-columns: repeat(5, 1fr);">
                    <button class="filter-btn" onclick="toggleFilter('head', 0, this)">0å¤´</button>
                    <button class="filter-btn" onclick="toggleFilter('head', 1, this)">1å¤´</button>
                    <button class="filter-btn" onclick="toggleFilter('head', 2, this)">2å¤´</button>
                    <button class="filter-btn" onclick="toggleFilter('head', 3, this)">3å¤´</button>
                    <button class="filter-btn" onclick="toggleFilter('head', 4, this)">4å¤´</button>
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">æŒ‰å°¾æ•°æ’é™¤:</span>
                <div class="btn-grid" style="grid-template-columns: repeat(5, 1fr);">
                    <button class="filter-btn" onclick="toggleFilter('tail', 1, this)">1å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 2, this)">2å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 3, this)">3å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 4, this)">4å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 5, this)">5å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 6, this)">6å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 7, this)">7å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 8, this)">8å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 9, this)">9å°¾</button>
                    <button class="filter-btn" onclick="toggleFilter('tail', 0, this)">0å°¾</button>
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">æŒ‰æ³¢è‰²æ’é™¤:</span>
                <div class="btn-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <button class="filter-btn" onclick="toggleFilter('color', 'red', this)" style="color:#c0392b">æ€çº¢æ³¢</button>
                    <button class="filter-btn" onclick="toggleFilter('color', 'blue', this)" style="color:#2980b9">æ€è“æ³¢</button>
                    <button class="filter-btn" onclick="toggleFilter('color', 'green', this)" style="color:#27ae60">æ€ç»¿æ³¢</button>
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">æŒ‰å•åŒ/å¤§å°æ’é™¤:</span>
                <div class="btn-grid" style="grid-template-columns: repeat(4, 1fr);">
                    <button class="filter-btn" onclick="toggleFilter('parity', 'odd', this)">æ€å•</button>
                    <button class="filter-btn" onclick="toggleFilter('parity', 'even', this)">æ€åŒ</button>
                    <button class="filter-btn" onclick="toggleFilter('size', 'small', this)">æ€å°</button>
                    <button class="filter-btn" onclick="toggleFilter('size', 'big', this)">æ€å¤§</button>
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">æŒ‰ç”Ÿè‚–æ’é™¤:</span>
                <div class="btn-grid" id="zodiacFilters" style="grid-template-columns: repeat(6, 1fr);"></div>
            </div>
            
        </div>
    </div>

<script>
    // --- 1. å…¨å±€é…ç½® ---
    const totalNums = 49;
    const zodiacs = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];
    const waves = {
        red: [1, 2, 7, 8, 12, 13, 18, 19, 23, 24, 29, 30, 34, 35, 40, 45, 46],
        blue: [3, 4, 9, 10, 14, 15, 20, 25, 26, 31, 36, 37, 41, 42, 47, 48],
        green: [5, 6, 11, 16, 17, 21, 22, 27, 28, 32, 33, 38, 39, 43, 44, 49]
    };

    // æ–°å¢ï¼šhead æ•°ç»„ç”¨äºå­˜å‚¨å¤´æ•°
    let activeFilters = { color: [], parity: [], size: [], zodiac: [], tail: [], head: [], customNums: [] };
    let currentZodiacIndex = 5; // é»˜è®¤è›‡
    let statsTextForCopy = "";

    // --- 2. åˆå§‹åŒ– ---
    window.onload = function() {
        initYearSelect();
        initApp();
    };

    // --- 3. Tab åˆ‡æ¢ ---
    window.switchTab = function(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        const tabs = document.querySelectorAll('.nav-item');
        if(tabName === 'stats') tabs[0].classList.add('active');
        else tabs[1].classList.add('active');
    }

    // --- 4. ç»Ÿè®¡é€»è¾‘ ---
    window.analyzeHistory = function() {
        const input = document.getElementById('historyInput');
        const output = document.getElementById('statsOutput');
        const btnCopy = document.getElementById('btnCopy');
        
        const regex = /\b(0?[1-9]|[1-4][0-9])\b/g;
        const matches = input.value.match(regex);
        
        output.style.display = 'block';
        output.innerHTML = '';
        statsTextForCopy = "";

        if (!matches || matches.length === 0) {
            output.innerHTML = '<div style="text-align:center; padding:20px; color:#999;">âš ï¸ è¯·å…ˆç²˜è´´å«æœ‰æ•°å­—çš„æ–‡æœ¬</div>';
            btnCopy.style.display = 'none';
            return;
        }

        const counts = {};
        matches.forEach(m => {
            const num = parseInt(m, 10);
            if (num >= 1 && num <= 49) counts[num] = (counts[num] || 0) + 1;
        });

        const groups = {};
        Object.keys(counts).forEach(numKey => {
            const num = parseInt(numKey);
            const count = counts[numKey];
            if (!groups[count]) groups[count] = [];
            groups[count].push(num);
        });

        const appeared = Object.keys(counts).map(Number);
        const missing = [];
        for(let i=1; i<=49; i++) if(!appeared.includes(i)) missing.push(i);
        if (missing.length > 0) groups[0] = missing;

        const sortedCounts = Object.keys(groups).map(Number).sort((a, b) => b - a);
        let html = '';
        let plainText = 'ã€å…­åˆå½©ç»Ÿè®¡ç»“æœã€‘\n';

        sortedCounts.forEach(count => {
            const nums = groups[count].sort((a, b) => a - b);
            const fmtNums = nums.map(n => n < 10 ? '0' + n : n);
            const numsStr = fmtNums.join(', ');
            const isHot = count >= 3;

            html += `<div class="stat-group">
                        <div class="stat-header">
                            <span>å‡ºç° ${count} æ¬¡</span>
                            <span class="stat-badge">å…± ${nums.length} ä¸ª</span>
                        </div>
                        <div class="stat-nums ${isHot ? 'hot-num' : ''}">${numsStr}</div>
                     </div>`;
            
            plainText += `[${count}æ¬¡](${nums.length}ä¸ª): ${numsStr}\n`;
        });

        output.innerHTML = html;
        statsTextForCopy = plainText;
        btnCopy.style.display = 'block';
    }

    window.clearStats = function() {
        if(confirm('ç¡®å®šè¦æ¸…ç©ºè¾“å…¥å’Œç»Ÿè®¡ç»“æœå—ï¼Ÿ')) {
            document.getElementById('historyInput').value = '';
            document.getElementById('statsOutput').innerHTML = '';
            document.getElementById('statsOutput').style.display = 'none';
            document.getElementById('btnCopy').style.display = 'none';
            statsTextForCopy = "";
        }
    }

    window.copyStats = function() { copyTextToClipboard(statsTextForCopy, 'btnCopy'); }

    // --- 5. è¿‡æ»¤åŠŸèƒ½é€»è¾‘ ---

    window.copyFilterResults = function() {
        const balls = document.querySelectorAll('#numbersGrid .ball:not(.disabled)');
        if(balls.length === 0) { alert("æ²¡æœ‰å‰©ä½™å·ç å¯å¤åˆ¶"); return; }

        let nums = [];
        balls.forEach(b => nums.push(b.innerText));
        const text = `ã€æ¨èå·ç ã€‘å…±${nums.length}ä¸ª:\n${nums.join(', ')}`;
        
        copyTextToClipboard(text, 'btnCopyResult');
    }

    function copyTextToClipboard(text, btnId) {
        if (!text) return;
        const btn = document.getElementById(btnId);
        
        const doCopy = (txt) => {
            const textArea = document.createElement("textarea");
            textArea.value = txt;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus(); textArea.select();
            try { document.execCommand('copy'); showSuccess(btn); } 
            catch (err) { alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æˆªå›¾"); }
            document.body.removeChild(textArea);
        };
        
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => showSuccess(btn)).catch(() => doCopy(text));
        } else {
            doCopy(text);
        }
    }

    function showSuccess(btn) {
        const original = btn.innerHTML;
        btn.innerHTML = 'âœ… å·²å¤åˆ¶';
        btn.style.background = '#27ae60';
        setTimeout(() => { btn.innerHTML = original; btn.style.background = ''; }, 2000);
    }

    window.applyCustomFilter = function() {
        const inputVal = document.getElementById('customFilterInput').value;
        if (!inputVal.trim()) return;

        const numMatches = inputVal.match(/\b(0?[1-9]|[1-4][0-9])\b/g);
        if (numMatches) {
            numMatches.forEach(n => {
                const num = parseInt(n, 10);
                if (!activeFilters.customNums.includes(num)) {
                    activeFilters.customNums.push(num);
                }
            });
        }

        zodiacs.forEach(z => {
            if (inputVal.includes(z)) {
                if (!activeFilters.zodiac.includes(z)) {
                    activeFilters.zodiac.push(z);
                    const btns = document.querySelectorAll('#zodiacFilters .filter-btn');
                    btns.forEach(btn => {
                        if (btn.innerText.includes(z)) btn.classList.add('active');
                    });
                }
            }
        });
        renderGrid();
    }

    function initYearSelect() {
        const select = document.getElementById('yearZodiac');
        zodiacs.forEach((z, index) => {
            const opt = document.createElement('option');
            opt.value = index;
            opt.text = z + "å¹´";
            if (z === 'è›‡') opt.selected = true;
            select.add(opt);
        });
    }

    function initApp() {
        currentZodiacIndex = parseInt(document.getElementById('yearZodiac').value);
        const zContainer = document.getElementById('zodiacFilters');
        zContainer.innerHTML = '';
        zodiacs.forEach(z => {
            const btn = document.createElement('button');
            btn.className = 'filter-btn';
            btn.innerText = "æ€" + z;
            btn.onclick = function() { toggleFilter('zodiac', z, this); };
            zContainer.appendChild(btn);
        });
        renderGrid();
    }

    function renderGrid() {
        const grid = document.getElementById('numbersGrid');
        grid.innerHTML = '';
        let validCount = 0;

        for (let i = 1; i <= totalNums; i++) {
            const info = getNumInfo(i);
            const isExcluded = checkFilter(i, info);
            
            const div = document.createElement('div');
            div.className = `ball ${info.color} ${isExcluded ? 'disabled' : ''}`;
            div.innerText = i < 10 ? '0' + i : i;
            if (!isExcluded) validCount++;
            grid.appendChild(div);
        }
        document.getElementById('result-count').innerText = validCount;
    }

    function getNumInfo(num) {
        let color = 'gray'; 
        if (waves.red.includes(num)) color = 'red';
        else if (waves.blue.includes(num)) color = 'blue';
        else if (waves.green.includes(num)) color = 'green';

        let zIndex = (currentZodiacIndex - (num - 1)) % 12;
        if (zIndex < 0) zIndex += 12;
        return { num, color, zodiac: zodiacs[zIndex] };
    }

    function checkFilter(num, info) {
        if (activeFilters.color.includes(info.color)) return true;
        if (activeFilters.parity.includes('odd') && num % 2 !== 0) return true;
        if (activeFilters.parity.includes('even') && num % 2 === 0) return true;
        if (activeFilters.size.includes('small') && num <= 24) return true;
        if (activeFilters.size.includes('big') && num >= 25) return true;
        if (activeFilters.zodiac.includes(info.zodiac)) return true;
        if (activeFilters.tail.includes(num % 10)) return true;
        // æ–°å¢ï¼šå¤´æ•°è¿‡æ»¤
        if (activeFilters.head.includes(Math.floor(num / 10))) return true;
        
        if (activeFilters.customNums.includes(num)) return true;
        return false;
    }

    window.toggleFilter = function(cat, val, btn) {
        const idx = activeFilters[cat].indexOf(val);
        if (idx === -1) {
            activeFilters[cat].push(val);
            btn.classList.add('active');
        } else {
            activeFilters[cat].splice(idx, 1);
            btn.classList.remove('active');
        }
        renderGrid();
    }

    window.resetFilters = function() {
        // é‡ç½®æ—¶å¢åŠ  head å­—æ®µ
        activeFilters = { color: [], parity: [], size: [], zodiac: [], tail: [], head: [], customNums: [] };
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('customFilterInput').value = '';
        renderGrid();
    }
</script>

</body>
</html>