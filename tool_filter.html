<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é€‰å·å·¥å…· - 158ä¹ç‚¹åŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2c3e50',
                        accent: '#3498db',
                        bg: '#f4f7f6',
                        red: '#e74c3c',
                        green: '#2ecc71',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"SF Pro Text"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                        mono: ['Monaco', 'Courier New', 'monospace'],
                    },
                    zIndex: {
                        'menu-overlay': '1000',
                        'header': '1001',
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        body {
            -webkit-font-smoothing: antialiased;
            touch-action: manipulation;
        }

        /* Custom Scrollbar for Textarea */
        textarea::-webkit-scrollbar {
            width: 8px;
        }

        textarea::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        textarea::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        textarea::-webkit-scrollbar-thumb:hover {
            background: #bbb;
        }

        .pop-menu {
            animation: scaleIn 0.2s ease forwards;
            transform-origin: top right;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .ball {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }





        .ball.not-selected,
        .ball.excluded {
            opacity: 0.3;
            filter: grayscale(80%);
            transform: scale(0.85);
            box-shadow: none;
        }



















        .ball-red {
            background: linear-gradient(135deg, #ff7675, #d63031);
        }

        .ball-blue {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .ball-green {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .ball-gray {
            background: #bdc3c7;
        }
    </style>
</head>

<body class="bg-bg text-gray-800 pb-10">

    <!-- Header -->
    <header
        class="sticky top-0 z-header bg-primary text-white h-[50px] px-4 flex justify-between items-center shadow-md">
        <div class="flex items-center w-[60px]">
            <a href="index.html"
                class="w-9 h-9 flex items-center justify-center rounded-full active:bg-white/20 transition-colors text-xl">ğŸ </a>
        </div>
        <div class="font-bold text-base tracking-wide">é€‰å·å·¥å…·</div>
        <div class="flex items-center justify-end w-[60px] relative">
            <div class="w-9 h-9 flex items-center justify-center rounded-full active:bg-white/20 transition-colors text-xl cursor-pointer"
                onclick="toggleMenu()">â¸¬</div>

            <!-- Dropdown Menu -->
            <div class="pop-menu absolute top-[45px] right-0 w-40 bg-white rounded-xl shadow-2xl p-2 hidden flex-col border border-gray-100 z-50"
                id="navMenu">
                <a href="index.html"
                    class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 rounded-lg active:bg-gray-50">
                    <span class="w-5 text-center">ğŸ </span> é¦–é¡µé—¨æˆ·
                </a>
                <a href="tool_filter.html"
                    class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-accent bg-blue-50 rounded-lg">
                    <span class="w-5 text-center">ğŸ“Š</span> é€‰å·å·¥å…·
                </a>
                <a href="tool_analysis.html"
                    class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 rounded-lg active:bg-gray-50">
                    <span class="w-5 text-center">ğŸ›¡ï¸</span> å†å²åˆ†æ
                </a>
                <a href="live.html"
                    class="flex items-center gap-3 px-4 py-3 text-sm font-medium text-gray-700 rounded-lg active:bg-gray-50">
                    <span class="w-5 text-center">ğŸ”´</span> å¼€å¥–ç›´æ’­
                </a>
            </div>
        </div>
    </header>

    <!-- Overlay -->
    <div class="fixed inset-0 z-menu-overlay hidden" id="menuOverlay" onclick="toggleMenu()"></div>

    <!-- Sticky Tabs -->
    <div class="sticky top-[50px] z-40 bg-bg p-3">
        <nav class="flex bg-gray-200 p-1 rounded-xl">
            <div class="flex-1 text-center py-2 text-sm font-semibold text-gray-500 rounded-lg cursor-pointer transition-all active-tab bg-white text-primary shadow-sm"
                onclick="switchTab('stats', this)">ğŸ“Š å·ç ç»Ÿè®¡</div>
            <div class="flex-1 text-center py-2 text-sm font-semibold text-gray-500 rounded-lg cursor-pointer transition-all"
                onclick="switchTab('filter', this)">ğŸ›¡ï¸ é€‰å·è¿‡æ»¤</div>
        </nav>
    </div>

    <!-- Stats Tab -->
    <div id="tab-stats" class="px-4 space-y-4 animate-fade-in">
        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-50">
            <textarea id="historyInput"
                class="w-full h-60 p-4 border border-gray-200 rounded-xl bg-gray-50 font-mono text-sm resize-none focus:border-accent focus:bg-white outline-none transition-colors"
                oninput="analyzeHistory()"
                placeholder="åœ¨æ­¤ç²˜è´´å†å²å¼€å¥–è®°å½•...&#10;æ”¯æŒæ ¼å¼ï¼š&#10;001æœŸ 01 05 12...&#10;æ”¯æŒè¾“å…¥ç”Ÿè‚–ï¼šé¼  ç‰› è™..."></textarea>
            <div class="flex gap-2.5 mt-4">
                <button
                    class="flex-1 h-11 bg-green text-white font-semibold rounded-xl shadow-lg shadow-green/30 active:scale-95 transition-transform flex items-center justify-center gap-1.5"
                    onclick="analyzeHistory()">
                    â–¶ å¼€å§‹ç»Ÿè®¡
                </button>
                <button id="btnCopy"
                    class="flex-1 h-11 bg-accent text-white font-semibold rounded-xl shadow-lg shadow-accent/30 active:scale-95 transition-transform hidden items-center justify-center gap-1.5"
                    onclick="copyStats()">
                    ğŸ“‹ å¤åˆ¶å…¨éƒ¨
                </button>
                <button
                    class="flex-[0.4] h-11 bg-gray-400 text-white font-semibold rounded-xl active:scale-95 transition-transform"
                    onclick="clearStats()">æ¸…ç©º</button>
            </div>
        </div>
        <div id="statsOutput" class="space-y-2.5"></div>
    </div>

    <!-- Filter Tab -->
    <div id="tab-filter" class="px-4 space-y-4 hidden animate-fade-in">
        <div
            class="bg-yellow-50 text-yellow-600 p-3 rounded-xl text-sm font-bold flex items-center justify-between border border-yellow-100">
            <span>âš™ï¸ å½“å‰å¹´ä»½è®¾ç½®</span>
            <select id="yearZodiac" onchange="initApp()"
                class="bg-transparent border-none outline-none font-bold text-yellow-700 text-right pr-2"></select>
        </div>

        <div class="bg-white rounded-2xl p-4 shadow-lg border border-gray-50 sticky top-[110px] z-30">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-2">
                    <h2 class="text-base font-bold text-primary m-0">å‰©ä½™ç»“æœ <span
                            class="bg-accent text-white px-2 py-0.5 rounded-full text-xs ml-1"
                            id="result-count">0</span>
                    </h2>
                </div>



                <div class="flex gap-2">
                    <button
                        class="bg-green/10 text-green px-3 py-1.5 rounded-lg text-xs font-bold active:scale-95 transition-all"
                        onclick="selectAll()">å…¨é€‰</button>
                    <button
                        class="bg-gray-100 text-gray-500 px-3 py-1.5 rounded-lg text-xs font-bold active:scale-95 transition-all"
                        onclick="clearAll()">æ¸…ç©º</button>
                    <button
                        class="bg-accent text-white px-3 py-1.5 rounded-lg text-xs font-bold active:scale-95 transition-all"
                        id="btnCopyResult" onclick="copyFilterResults()">å¤åˆ¶å·ç </button>
                </div>
            </div>
            <div id="numbersGrid" class="grid grid-cols-7 gap-1.5 justify-items-center"></div>
        </div>

        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-50 space-y-5">



            <!-- Custom Include -->
            <div>
                <div
                    class="text-[13px] font-bold text-gray-400 uppercase tracking-wider mb-2.5 flex items-center after:content-[''] after:flex-1 after:h-px after:bg-gray-100 after:ml-2">
                    è‡ªå®šä¹‰åŠ å…¥</div>
                <textarea id="customIncludeInput"
                    class="w-full h-20 p-3 border border-gray-100 rounded-xl bg-gray-50 text-sm resize-none mb-2.5 focus:border-green outline-none"
                    placeholder="è¾“å…¥æƒ³è¦ä¿ç•™çš„å·ç æˆ–ç”Ÿè‚–ï¼Œç©ºæ ¼éš”å¼€ (ä¾‹: 08 é¾™ 16)"></textarea>
                <div class="flex gap-2.5">
                    <button
                        class="flex-1 bg-green text-white py-2.5 rounded-lg font-semibold text-sm active:scale-95 transition-transform"
                        onclick="applyCustomInclude()">âœ… æ‰§è¡ŒåŠ å…¥</button>
                </div>
            </div>

            <!-- Custom Filter -->
            <div>
                <div
                    class="text-[13px] font-bold text-gray-400 uppercase tracking-wider mb-2.5 flex items-center after:content-[''] after:flex-1 after:h-px after:bg-gray-100 after:ml-2">
                    è‡ªå®šä¹‰æ’é™¤</div>
                <textarea id="customFilterInput"
                    class="w-full h-20 p-3 border border-gray-100 rounded-xl bg-gray-50 text-sm resize-none mb-2.5 focus:border-accent outline-none"
                    placeholder="è¾“å…¥å·ç æˆ–ç”Ÿè‚–ï¼Œç©ºæ ¼éš”å¼€ (ä¾‹: 01 é¼  49)"></textarea>
                <div class="flex gap-2.5">
                    <button
                        class="flex-[2] bg-primary text-white py-2.5 rounded-lg font-semibold text-sm active:scale-95 transition-transform"
                        onclick="applyCustomFilter()">ğŸš« æ‰§è¡Œæ’é™¤</button>
                    <button
                        class="flex-1 bg-red-50 text-red border border-red-100 py-2.5 rounded-lg font-semibold text-sm active:scale-95 transition-transform"
                        onclick="resetFilters()">ğŸ”„ é‡ç½®</button>
                </div>
            </div>

            <!-- Head Filter -->
            <div>
                <div
                    class="text-[13px] font-bold text-gray-400 uppercase tracking-wider mb-2.5 flex items-center after:content-[''] after:flex-1 after:h-px after:bg-gray-100 after:ml-2">
                    æŒ‰å¤´æ•°æ’é™¤</div>
                <div class="grid grid-cols-5 gap-2">
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('head', 0, this)">0å¤´</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('head', 1, this)">1å¤´</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('head', 2, this)">2å¤´</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('head', 3, this)">3å¤´</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('head', 4, this)">4å¤´</button>
                </div>
            </div>

            <!-- Tail Filter -->
            <div>
                <div
                    class="text-[13px] font-bold text-gray-400 uppercase tracking-wider mb-2.5 flex items-center after:content-[''] after:flex-1 after:h-px after:bg-gray-100 after:ml-2">
                    æŒ‰å°¾æ•°æ’é™¤</div>
                <div class="grid grid-cols-5 gap-2">
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 1, this)">1å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 2, this)">2å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 3, this)">3å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 4, this)">4å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 5, this)">5å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 6, this)">6å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 7, this)">7å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 8, this)">8å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 9, this)">9å°¾</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('tail', 0, this)">0å°¾</button>
                </div>
            </div>

            <!-- Color/Parity/Size Filter -->
            <div>
                <div
                    class="text-[13px] font-bold text-gray-400 uppercase tracking-wider mb-2.5 flex items-center after:content-[''] after:flex-1 after:h-px after:bg-gray-100 after:ml-2">
                    æŒ‰æ³¢è‰² / å•åŒ / å¤§å°</div>
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-red active:scale-95 transition-all"
                        onclick="toggleFilter('color', 'red', this)">æ€çº¢æ³¢</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-accent active:scale-95 transition-all"
                        onclick="toggleFilter('color', 'blue', this)">æ€è“æ³¢</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-green active:scale-95 transition-all"
                        onclick="toggleFilter('color', 'green', this)">æ€ç»¿æ³¢</button>
                </div>
                <div class="grid grid-cols-4 gap-2">
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('parity', 'odd', this)">æ€å•</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('parity', 'even', this)">æ€åŒ</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('size', 'small', this)">æ€å°</button>
                    <button
                        class="filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all"
                        onclick="toggleFilter('size', 'big', this)">æ€å¤§</button>
                </div>
            </div>

            <!-- Zodiac Filter -->
            <div>
                <div
                    class="text-[13px] font-bold text-gray-400 uppercase tracking-wider mb-2.5 flex items-center after:content-[''] after:flex-1 after:h-px after:bg-gray-100 after:ml-2">
                    æŒ‰ç”Ÿè‚–æ’é™¤</div>
                <div class="grid grid-cols-4 gap-2" id="zodiacFilters"></div>
            </div>
        </div>
    </div>

    <script>
        function toggleMenu() {
            const menu = document.getElementById('navMenu');
            const overlay = document.getElementById('menuOverlay');
            menu.classList.toggle('hidden');
            menu.classList.toggle('flex');
            overlay.classList.toggle('hidden');
        }

        const totalNums = 49;
        const zodiacs = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];
        const waves = {
            red: [1, 2, 7, 8, 12, 13, 18, 19, 23, 24, 29, 30, 34, 35, 40, 45, 46],
            blue: [3, 4, 9, 10, 14, 15, 20, 25, 26, 31, 36, 37, 41, 42, 47, 48],
            green: [5, 6, 11, 16, 17, 21, 22, 27, 28, 32, 33, 38, 39, 43, 44, 49]
        };

        let activeFilters = { color: [], parity: [], size: [], zodiac: [], tail: [], head: [], customNums: [], baseNums: [] };
        let currentZodiacIndex = 5;
        let statsTextForCopy = "";

        window.onload = function () { initYearSelect(); initApp(); };

        window.switchTab = function (tabName, el) {
            document.getElementById('tab-stats').classList.add('hidden');
            document.getElementById('tab-filter').classList.add('hidden');
            document.getElementById('tab-' + tabName).classList.remove('hidden');

            document.querySelectorAll('nav div').forEach(div => {
                div.classList.remove('bg-white', 'text-primary', 'shadow-sm');
            });
            el.classList.add('bg-white', 'text-primary', 'shadow-sm');
        }

        window.analyzeHistory = function () {
            const input = document.getElementById('historyInput');
            const output = document.getElementById('statsOutput');
            const btnCopy = document.getElementById('btnCopy');

            // åŒ¹é…æ•°å­—
            const numRegex = /\b(0?[1-9]|[1-4][0-9])\b/g;
            const numMatches = input.value.match(numRegex) || [];

            // åŒ¹é…ç”Ÿè‚–
            const zodiacMatches = [];
            zodiacs.forEach(z => {
                const zRegex = new RegExp(z, 'g');
                const count = (input.value.match(zRegex) || []).length;
                for (let i = 0; i < count; i++) zodiacMatches.push(z);
            });

            output.innerHTML = ''; statsTextForCopy = "";

            if (numMatches.length === 0 && zodiacMatches.length === 0) {
                output.innerHTML = '<div class="text-center py-8 text-gray-400 text-sm">âš ï¸ è¯·å…ˆè¾“å…¥æœ‰æ•ˆå·ç æˆ–ç”Ÿè‚–</div>';
                btnCopy.classList.add('hidden'); btnCopy.classList.remove('flex'); return;
            }

            const counts = {};

            // ç»Ÿè®¡æ•°å­—
            numMatches.forEach(m => {
                const num = parseInt(m, 10);
                if (num >= 1 && num <= 49) counts[num] = (counts[num] || 0) + 1;
            });

            // ç»Ÿè®¡ç”Ÿè‚–å¯¹åº”çš„å·ç 
            zodiacMatches.forEach(z => {
                const nums = getNumsByZodiac(z);
                nums.forEach(num => {
                    counts[num] = (counts[num] || 0) + 1;
                });
            });

            const groups = {};
            Object.keys(counts).forEach(numKey => {
                const num = parseInt(numKey); const count = counts[numKey];
                if (!groups[count]) groups[count] = []; groups[count].push(num);
            });

            const appeared = Object.keys(counts).map(Number);
            const missing = [];
            for (let i = 1; i <= 49; i++) if (!appeared.includes(i)) missing.push(i);
            if (missing.length > 0) groups[0] = missing;

            const sortedCounts = Object.keys(groups).map(Number).sort((a, b) => b - a);
            let html = ''; let plainText = 'ã€å·ç ç»Ÿè®¡ç»“æœã€‘\n';

            sortedCounts.forEach(count => {
                const nums = groups[count].sort((a, b) => a - b);
                const fmtNums = nums.map(n => n < 10 ? '0' + n : n);
                const numsStr = fmtNums.join(', '); const isHot = count >= 3;
                const groupCopyText = fmtNums.join(', ');

                html += `
                <div class="bg-white p-3 rounded-xl shadow-sm border border-gray-50">
                    <div class="flex justify-between items-center text-xs text-gray-400 uppercase tracking-wide mb-1.5">
                        <span>å‡ºç° ${count} æ¬¡ (å…± ${nums.length} ç )</span>
                        <button class="bg-gray-100 text-accent px-2 py-1 rounded-md font-bold active:scale-95 transition-transform" 
                                onclick="copyGroup('(å…±${nums.length}ç ): ${groupCopyText}', this)">å¤åˆ¶è¯¥ç»„</button>
                    </div>
                    <div class="font-mono text-base leading-relaxed break-all ${isHot ? 'text-red font-bold' : 'text-gray-700'}">
                        ${numsStr}
                    </div>
                </div>`;
                plainText += `[${count}æ¬¡](${nums.length}ä¸ª): ${numsStr}\n`;
            });
            output.innerHTML = html; statsTextForCopy = plainText;
            btnCopy.classList.remove('hidden'); btnCopy.classList.add('flex');
        }

        function getNumsByZodiac(z) {
            const results = [];
            for (let i = 1; i <= 49; i++) {
                if (getNumInfo(i).zodiac === z) results.push(i);
            }
            return results;
        }

        window.copyGroup = function (text, btn) {
            const originalText = btn.innerText;
            copyTextToClipboard(text, btn, true);
        }

        window.clearStats = function () { document.getElementById('historyInput').value = ''; document.getElementById('statsOutput').innerHTML = ''; document.getElementById('btnCopy').classList.add('hidden'); document.getElementById('btnCopy').classList.remove('flex'); statsTextForCopy = ""; }
        window.copyStats = function () { copyTextToClipboard(statsTextForCopy, document.getElementById('btnCopy')); }
        window.copyFilterResults = function () {
            const balls = document.querySelectorAll('#numbersGrid .ball:not(.not-selected):not(.excluded)');
            if (balls.length === 0) { alert("æ— å·ç å¯å¤åˆ¶"); return; }
            let nums = []; balls.forEach(b => nums.push(b.innerText));
            const text = `ã€æ¨èå·ç ã€‘å…±${nums.length}ä¸ª:\n${nums.join(', ')}`;
            copyTextToClipboard(text, document.getElementById('btnCopyResult'));
        }

        function copyTextToClipboard(text, btn, isSmallBtn = false) {
            if (!text) return;
            const originalText = btn.innerHTML;
            const doCopy = (txt) => {
                const textArea = document.createElement("textarea"); textArea.value = txt;
                textArea.style.position = "fixed"; textArea.style.left = "-9999px";
                document.body.appendChild(textArea); textArea.focus(); textArea.select();
                try { document.execCommand('copy'); showSuccess(btn, originalText, isSmallBtn); } catch (err) { alert("å¤åˆ¶å¤±è´¥"); }
                document.body.removeChild(textArea);
            };
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => showSuccess(btn, originalText, isSmallBtn)).catch(() => doCopy(text));
            } else {
                doCopy(text);
            }
        }

        function showSuccess(btn, originalText, isSmallBtn) {
            btn.innerHTML = 'âœ… å·²å¤åˆ¶';
            if (!isSmallBtn) {
                btn.classList.add('bg-green'); btn.classList.remove('bg-accent', 'bg-gray-100');
                if (btn.id === 'btnCopyResult') btn.classList.add('text-white');
            } else {
                btn.classList.add('text-green'); btn.classList.remove('text-accent');
            }

            setTimeout(() => {
                btn.innerHTML = originalText;
                if (!isSmallBtn) {
                    btn.classList.remove('bg-green');
                    if (btn.id === 'btnCopyResult') {
                        btn.classList.add('bg-gray-100'); btn.classList.remove('text-white');
                    } else {
                        btn.classList.add('bg-accent');
                    }
                } else {
                    btn.classList.remove('text-green'); btn.classList.add('text-accent');
                }
            }, 2000);
        }

        window.applyCustomFilter = function () {
            const inputVal = document.getElementById('customFilterInput').value; if (!inputVal.trim()) return;
            const numMatches = inputVal.match(/\b(0?[1-9]|[1-4][0-9])\b/g);
            if (numMatches) { numMatches.forEach(n => { const num = parseInt(n, 10); if (!activeFilters.customNums.includes(num)) activeFilters.customNums.push(num); }); }
            zodiacs.forEach(z => {
                if (inputVal.includes(z)) {
                    if (!activeFilters.zodiac.includes(z)) {
                        activeFilters.zodiac.push(z);
                        const btns = document.querySelectorAll('#zodiacFilters .filter-btn');
                        btns.forEach(btn => {
                            if (btn.innerText.includes(z)) {
                                btn.classList.add('bg-primary', 'text-white', 'border-primary');
                                btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-100');
                            }
                        });
                    }
                }
            });
            renderGrid();
        }
        window.applyCustomInclude = function () {
            const inputVal = document.getElementById('customIncludeInput').value; if (!inputVal.trim()) return;
            const numMatches = inputVal.match(/\b(0?[1-9]|[1-4][0-9])\b/g);
            if (numMatches) { numMatches.forEach(n => { const num = parseInt(n, 10); if (!activeFilters.baseNums.includes(num)) activeFilters.baseNums.push(num); }); }
            zodiacs.forEach(z => { if (inputVal.includes(z)) { const nums = getNumsByZodiac(z); nums.forEach(num => { if (!activeFilters.baseNums.includes(num)) activeFilters.baseNums.push(num); }); } });
            renderGrid();
        }
        window.toggleBaseNum = function (num) {
            const idx = activeFilters.baseNums.indexOf(num);
            if (idx === -1) activeFilters.baseNums.push(num);
            else activeFilters.baseNums.splice(idx, 1);
            renderGrid();
        }
        window.selectAll = function () {
            activeFilters.baseNums = [];
            for (let i = 1; i <= 49; i++) activeFilters.baseNums.push(i);
            renderGrid();
        }
        window.clearAll = function () {
            activeFilters.baseNums = [];
            renderGrid();
        }







        function initYearSelect() { const select = document.getElementById('yearZodiac'); zodiacs.forEach((z, index) => { const opt = document.createElement('option'); opt.value = index; opt.text = z + "å¹´"; if (z === 'è›‡') opt.selected = true; select.add(opt); }); }
        function initApp() { currentZodiacIndex = parseInt(document.getElementById('yearZodiac').value); const zContainer = document.getElementById('zodiacFilters'); zContainer.innerHTML = ''; zodiacs.forEach(z => { const btn = document.createElement('button'); btn.className = 'filter-btn border border-gray-100 bg-white py-3 rounded-xl text-[13px] font-medium text-gray-600 active:scale-95 transition-all'; btn.innerText = "æ€" + z; btn.onclick = function () { toggleFilter('zodiac', z, this); }; zContainer.appendChild(btn); }); renderGrid(); }
        function renderGrid() {
            const grid = document.getElementById('numbersGrid'); grid.innerHTML = ''; let validCount = 0;

            for (let i = 1; i <= totalNums; i++) {
                const info = getNumInfo(i);
                const isSelected = activeFilters.baseNums.includes(i);
                const isExcluded = checkFilter(i, info);

                let colorClass = 'ball-gray';
                if (info.color === 'red') colorClass = 'ball-red';
                else if (info.color === 'blue') colorClass = 'ball-blue';
                else if (info.color === 'green') colorClass = 'ball-green';






                const div = document.createElement('div');
                div.className = `ball w-[34px] h-[34px] rounded-full flex justify-center items-center text-white font-bold text-sm ${colorClass} ${!isSelected ? 'not-selected' : ''} ${isExcluded ? 'excluded' : ''}`;
                div.innerText = i < 10 ? '0' + i : i;
                div.onclick = () => toggleBaseNum(i);
                if (isSelected && !isExcluded) validCount++;
                grid.appendChild(div);
            }
            document.getElementById('result-count').innerText = validCount;
        }















        function getNumInfo(num) {
            let color = 'gray'; if (waves.red.includes(num)) color = 'red'; else if (waves.blue.includes(num)) color = 'blue'; else if (waves.green.includes(num)) color = 'green';
            let zIndex = (currentZodiacIndex - (num - 1)) % 12; if (zIndex < 0) zIndex += 12; return { num, color, zodiac: zodiacs[zIndex] };
        }
        function checkFilter(num, info) {

            if (activeFilters.color.includes(info.color)) return true;
            if (activeFilters.parity.includes('odd') && num % 2 !== 0) return true;
            if (activeFilters.parity.includes('even') && num % 2 === 0) return true;
            if (activeFilters.size.includes('small') && num <= 24) return true;
            if (activeFilters.size.includes('big') && num >= 25) return true;
            if (activeFilters.zodiac.includes(info.zodiac)) return true;
            if (activeFilters.tail.includes(num % 10)) return true;
            if (activeFilters.head.includes(Math.floor(num / 10))) return true;
            if (activeFilters.customNums.includes(num)) return true;
            return false;
        }
        window.toggleFilter = function (cat, val, btn) {
            const idx = activeFilters[cat].indexOf(val);
            if (idx === -1) {
                activeFilters[cat].push(val);
                btn.classList.add('bg-primary', 'text-white', 'border-primary');
                btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-100');
            } else {
                activeFilters[cat].splice(idx, 1);
                btn.classList.remove('bg-primary', 'text-white', 'border-primary');
                btn.classList.add('bg-white', 'text-gray-600', 'border-gray-100');
            }
            renderGrid();
        }
        window.resetFilters = function () {
            activeFilters = { color: [], parity: [], size: [], zodiac: [], tail: [], head: [], customNums: [], baseNums: [] };
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('bg-primary', 'text-white', 'border-primary');
                b.classList.add('bg-white', 'text-gray-600', 'border-gray-100');
            });
            document.getElementById('customFilterInput').value = '';
            document.getElementById('customIncludeInput').value = '';
            renderGrid();
        }
    </script>
</body>

</html>